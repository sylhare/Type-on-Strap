---
published: true
layout: post
tags:
  - AutoMake
---
## step build automake
### 1. generate aclocal.m4  with  **_aclocal_** \
> the file contain all AUTOMAKE's Macro which is needed in building process\
> aclocal also scan configure.ac to put needed macro to aclocal.m4 file

### 2. autoconf use aclocal.m4 with it's macro to generate configure program 
> autoheader generate header in ( AC_CONFIG_HEADERS parameter conifgure.ac)
  automake --add-missing . it is used for create makefile.in.
  

### 3. ./configure to create Makefile follow what configure.ac list up 

**simpler step :**
1. call autoreconf -iv  ( create depencency and Makefile.in )
2. ./configure          ( create Makefile )
3. make                 ( run as normal Makefile = make all)

## argument pass to automake
In configure.ac
create variable with AM_CONDITIONAL\
```
#configure.ac
AM_CONDITIONAL([MY_FLAG_SET], [test "%MY_FLAG" = "Y"])

#Makefile.am where need check argument MY_FLAGS
if MY_FLAGS_SET
AM_CFLAGS += -DMY_FLAGS_SET
else
AM_CFLAGS += -DNO_FLAGS_SET
endif
```
## advance argument passing argument
We can use flag & alert with AC_ARG_ENABLE instead pass argument directly
```
AC_ARG_ENABLE([debug],
[  --enable-debug    Turn on debugging],
[case "${enableval}" in
  yes) debug=true ;;
  no)  debug=false ;;
  *) AC_MSG_ERROR([bad value ${enableval} for --enable-debug]) ;;
esac],[debug=false])
AM_CONDITIONAL([DEBUG], [test x$debug = xtrue])
```
After update configure.ac and Makefile.am. we follow seqence cmd : 
1. autoreconf -iv 
2. ./configure MY_FLAGS_SET=Y
3. make

## Building a program

Follow below template form
## Linking the program

**LDADD** , **prog_LDADD** this variable is used to specify additional object files or libraries to link with\

example with static lib

> https://github.com/vuhailongkl97/network/commit/238c438d9302a6dee8b0d0c208ee21f455288418


### GNU Libtool

**Libtool** abstracts shared and static libraries into a unified concept . with **.la** prefix and object file **.lo** in buiding process\




# NOTE
> Automake always uses two of these variables when compiling C sources files. When compiling an object file for the mumble target, the first variable will be **prog_CPPFLAGS** if it is defined, or **AM_CPPFLAGS** otherwise. The second variable is always **CPPFLAGS** . 

> The **foreign** option tells Automake that this package will not follow the GNU Standards. GNU packages should always distribute additional files such as ChangeLog, AUTHORS, etc. We do not want automake to complain about these missing files in our small example. 






